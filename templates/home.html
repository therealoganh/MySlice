<!DOCTYPE html>
<html>
<head>
    <title>MySlice (of the internet) 🍕 </title>
</head>
<body>
    <h1>MySlice (of the internet)🍕</h1>
    <p>Recently, a friend told me about the <b>"Dead Internet Theory"</b>, which is the idea that the internet died some years ago and now mostly consists of bots interacting with other bots. This was a pretty depressing theory to me, so I've created MySlice (of the internet), where <em>humans</em> are meant to interact with other <em>humans</em>.</p>

    <!-- Create post button  -->
    <a href="{{ url_for('create') }}">
        <button style="margin-bottom: 1rem;">Create New Post</button>
    </a>

{% for post in posts %}
    {% set post_index = loop.index0 %}
  <div class="post" style="border: 1px solid #ccc; margin-bottom: 1rem; padding: 1rem;">
    <h2>{{ post.title }}</h2>
    <p>
      <strong style="color: {{ post.color or '#000' }}">
        {{ post.avatar or "👤" }} {{ post.author }}
      </strong>
      — <em style="color: gray;">{{ post.timestamp }}</em>
    </p>
    <p>{{ post.content }}</p>

      <!-- Only show buttons if user is author of post  -->
      {% if post.author == current_author %}
      <!-- Buttons -->
      <form method="POST" action="/delete/{{ loop.index0 }}" style="margin-top: 1rem;" onsubmit="return confirm('Are you sure you want to delete this post?');">
        <button type="submit">Delete</button>
      </form>
      <form method="GET" action="/edit/{{ loop.index0 }}" style="display: inline;">
        <button type="submit">Edit</button>
      </form>
    {% endif %}

    <!-- Replies -->
    <div class="replies" style="margin-left: 2rem; border-left: 2px solid #ccc; padding-left: 1rem; margin-top: 1rem;">
      {% for reply in post.replies or [] %}
        <div class="reply" style="margin-bottom: 1rem;">
          <strong style="color: {{ reply.color or '#000' }}">
            {{ reply.avatar or "👤" }} {{ reply.author }}
          </strong>
          — <em style="color: gray;">{{ reply.timestamp }}</em>
          <p>{{ reply.content }}</p>

            {% if current_author == reply.author %}
              <form method="POST" action="/delete_reply/{{ post_index }}/{{ loop.index0 }}" style="margin-top: 0.5rem;" onsubmit="return confirm('Delete this reply?');">
                <button type="submit">Delete Reply</button>
              </form>
            {% endif %}
          </div>
        {% endfor %}
      </div>

    <!-- Reply form -->
    <form method="POST" action="/reply/{{ loop.index0 }}" style="margin-top: 1rem;">
      <textarea name="content" placeholder="Write a reply..." required></textarea>
      <button type="submit">Reply</button>
    </form>
  </div>
{% endfor %}
</body>
</html>